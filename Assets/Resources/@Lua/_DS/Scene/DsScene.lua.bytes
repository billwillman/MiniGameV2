---- DS的场景

local DsScene = _MOE.class("DsScene", _MOE.BaseScene)
DsScene[".superctor"] = true -- 会调用父类方法

function DsScene:Ctor(sceneName, dsNetworkManager)
    self.DsNetworkManager = dsNetworkManager
    self.Transport = dsNetworkManager.gameObject:GetComponent(typeof(CS.Unity.Netcode.Transports.UTP.UnityTransport))
end

function DsScene:OnEnter()
    -- 开启
    _MOE.Logger.Log("[DS] MultiScene Enter")
    local dsData = _MOE.TB["dsData"]
    local ip = dsData.ip or "127.0.0.1"
    local port = dsData.port or 7777
    self.Transport:SetConnectionData(ip, port)
    if not self.DsNetworkManager:StartServer() then
        _MOE.Logger.LogError("[DS] DsScene:StartServer False")
        _MOE.GameApp:QuitGame()
        return
    end
    _MOE.Logger.Log("[DS] DsScene:StartServer True")
    -- 连接GS
end

function DsScene:OnExit()
    self.DsNetworkManager = nil
    self.Transport = nil
end

function DsScene:OnSceneLoadFail()
    _MOE.Logger.LogError("[DsScene] OnSceneLoadFail")
    _MOE.GameApp:QuitGame()
end

return DsScene